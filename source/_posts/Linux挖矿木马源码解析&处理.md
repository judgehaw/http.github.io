---
title: Linux挖矿木马源码解析&处理
copyright: true
date: 2020-01-15 15:02:43
tags: 安全
categories: "安全"
---

------
## 记一次挖矿木马源码解析&处理

##### 前段时间，朋友公司的云服务器中挖矿木马并向我求救。

------
<!-- more -->

###### 首先我用ssh登录之后查看了他的硬件占用情况：

> 看到最上面有个叫[kthrotlds]的进程占用系统百分之百的CPU，感觉应该是被植入挖矿的脚本了。

###### Linux服务器被挖矿的话是会有计划任务的，我看了一下这个计划任务。这个计划任务是从他们服务器来下载对应引导脚本及程序脚本的。
###### 从其URL中我看到结尾的文件名是ldm，于是用`find / -name ldm`找到在用户家目录及根目录都有这两个脚本。

------

###### 花了半天的时间来分析脚本，主要是为了研究这个脚本的工作原理，其实也没研究多少，看到脚本中有用到服务器的ssh-key、curl、crontab、wget等命令。
###### 于是先更改了ssh的密码，在删除ssh密钥的时候发现这个文件被加了i权限，然后在使用命令取掉i权限后发现又会重新加上，应该是程序搞得，每隔几秒钟会判断这个文件得权限还有文件是否存在，然后删除得时候删除之后又会重新生成。
###### 不得不说脚本考虑得范围真的很细致，最后只能通过yum删除了wget程序，再删除密钥文件之后就没有再下载了。

------

###### 通过计划任务中得URL找到对应服务器得IP，然后在防火墙将这些IP全部放黑名单，再删除计划任务，删除引导脚本及程序脚本，再通过全局搜索再没找到包含ldm的脚本，这才放心。

------

####  最后总结一下，挖矿木马一般隐藏在网页链接，或者不正规工具下载网站中，建议大家在下载工具时切记去相关官网去下载，下载完成后对照官网的md5摘要信息是否跟下载得到的一样，可以通过一款叫hashmd5的工具去对照查看，然后在安装软件时不要勾选捆绑软件的安装按钮，浏览网页时切勿贪财好色，很多这种脚本都会通过网页附着在其中的小广告的关闭按钮上，或者广告本身，然后静默启动。建议大家打开电脑自带防火墙，安装火绒等杀毒软件并定期进行杀毒操作。
##### 非常感谢大家的细心阅读！鞠躬！

###### 大家可以去我有道云笔记看到过程截图及程序源文件，附链接：

[有道云笔记](http://note.youdao.com/noteshare?id=a284464f2b4e1b15cf0f762c35975897)

